<!-- eslint-disable @angular-eslint/template/elements-content -->
<div class="flex flex-column" style="width: 100%; height: 100%;">
  <div class="flex toolbar">
    <his-app-store-editor-toolbar
      [customTemplate]="!_id ? createToolbar : updateToolbar"
      [title]="title">
    </his-app-store-editor-toolbar>
  </div>
  <div class="flex flex-1">
    <div class="p-3 h-full flex flex-column" style="width: 100%;">
      <div class="card flex-1 p-2">
        <div *ngIf="!_id; else editTitle">
          <h5 i18n>新增應用程式</h5>
        </div>
        <ng-template #editTitle>
          <h5 i18n>編輯應用程式</h5>
        </ng-template>
        <div class="grid">
          <div class="col-12 xl:col-10">
            <div class="grid">
              <div class="col-6">
                <h6 i18n>應用程式名稱</h6>
                <input type="text" pInputText [(ngModel)]="editableApp.appTitle" style="width: 100%;">
              </div>
              <div class="col-6">
                <h6 i18n>應用程式代號</h6>
                <input type="text" pInputText [(ngModel)]="editableApp._id" [disabled]="true" style="width: 100%;">
              </div>
              <div class="col-6">
                <h6 i18n>類別</h6>
                <p-dropdown [options]="typeOptions"
                            [(ngModel)]="appType"
                            i18n-placeholder
                            placeholder="請選擇"
                            [showClear]="true"
                            [style]="{'width':'100%'}"
                            optionLabel="type"></p-dropdown>
              </div>
              <div class="col-fixed flex gap-4 align-items-end justify-content-start">
                <div class="authorityBox">
                  <p-checkbox name="group1" [binary]="true" [(ngModel)]="editableApp.isAuth" id="authNeed"></p-checkbox>
                  <label for="authNeed" i18n>是否需要授權</label>
                </div>
              </div>
              <div class="col flex align-items-end justify-content-start">
                <div class="iconBox">
                  <h6 i18n>圖標</h6>
                  <button pButton pRipple (click)="onDialog()" icon="pi {{showIconStyle}}" class="icon-selector" [style]="appType.showColor"></button>
                  <p-dialog header="Header" [(visible)]="isIconVisible" [style]="{ width: '769px', height: '59.1%' }" [closable]="false">
                    <ng-template pTemplate="header">
                      <div class="flex flex-1 justify-content-between align-items-center">
                        <div class="align-items-center">
                          <span class="text-xl font-bold text-center" i18n>選擇圖標</span>
                        </div>
                        <div class="cross">
                          <p-button icon="pi pi-times" (click)="onCancelSelect()"></p-button>
                        </div>
                      </div>
                    </ng-template>
                    <div class="flex flex-wrap align-content-start align-items-start pick-box">
                      <ng-container *ngFor="let icon of iconList">
                        <div class="flex text-center" style="min-height: 56px; min-width: 56px;">
                          <button pButton icon="pi {{icon}}" class="icon-selected" [class]="appType.colorClass" (click)="onSelectIcon(icon)"></button>
                        </div>
                      </ng-container>
                    </div>
                    <ng-template pTemplate="footer">
                      <p-button (click)="onCancelSelect()" i18n-label label="取消" styleClass="p-button-secondary"></p-button>
                      <p-button (click)="onConfirmIcon()" i18n-label label="確定"></p-button>
                    </ng-template>
                  </p-dialog>
                </div>
              </div>
            </div>
          </div>
          <div class="col-4 xl:col-2">
            <h6 i18n>預覽</h6>
            <div class="back" style="min-width: 175px">
              <div class="card flex app-preview" style="height: 100%;">
                <div class="flex align-items-center justify-content-center icon-preview" [style]="appType.showColor"  >
                  <i class="pi {{showIconStyle}}" style="color: white; font-size: 48px"></i>
                </div>
                <div class="flex flex-1 flex-column text-preview">
                  <div class="flex align-items-center top-text">
                    <div class="flex align-items-start">
                      <p class="caption-s">v{{editableApp.versionNo}}</p>
                    </div>
                    <div class="flex align-items-center justify-content-center">
                      <i class="pi pi-star" style="font-size: 18px;"></i>
                    </div>
                  </div>
                  <div class="flex align-items-start align-self-stretch label-l">
                    {{editableApp.appTitle || previewTitle}}
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12">
            <h6 i18n>網頁路徑</h6>
            <input type="text" pInputText [(ngModel)]="editableApp.appUrl" style="width: 100%;">
          </div>
          <div class="col-4">
            <h6 i18n>首頁清單</h6>
            <p-dropdown [options]="appPages"
                        [(ngModel)]="editableApp.appHome.display"
                        i18n-placeholder
                        placeholder="請選擇"
                        [showClear]="true"
                        [style]="{'width':'100%'}"
                        optionLabel="pageTitle"
                        [filter]="true"></p-dropdown>
          </div>
          <div class="col-4">
            <h6 i18n>使用語言</h6>
            <p-dropdown [options]="languageOptions"
                        [(ngModel)]="editableApp.appLanguage"
                        i18n-placeholder
                        placeholder="請選擇"
                        [showClear]="true"
                        [style]="{'width':'100%'}"></p-dropdown>
          </div>
          <div class="col-4">
            <h6 i18n>版本</h6>
            <input type="text" pInputText [(ngModel)]="editableApp.versionNo" style="width: 100%;">
          </div>
          <div class="col-12">
            <div class="flex flex-wrap justify-content-start align-content-center gap-2 addBox">
                <h6 i18n>應用頁面</h6>
                <button pButton pRipple i18n-label label="加入" (click)="onModifyClick()" class="p-button-rounded p-button-outlined icon-add"></button>
                <p-dialog [(visible)]="isTableVisible"
                          [position]="'bottom'"
                          [modal]="true"
                          [style]="{ width: '100%', height: '90vh' , margin: '0'}"
                          class="page-list" [closable]="false">
                  <ng-template pTemplate="header">
                    <div class="flex flex-1 justify-content-between align-items-center">
                        <span class="text-xl font-bold" i18n>加入應用頁面</span>
                        <button pButton pRipple icon="pi pi-times" class="p-button-text p-button-rounded" (click)="onCancelModify()"></button>
                    </div>
                  </ng-template>
                  <his-add-pages-list [appPagesList]="appPages"
                                      [visible]="isTableVisible"
                                      (cancel)="onCancelModify()"
                                      (apply)="onApplyModify($event)"></his-add-pages-list>
                </p-dialog>
            </div>
            <p-table [value]="appPages" dataKey="id" [rows]="10" [loading]="false" [rowHover]="true" [reorderableColumns]="true" responsiveLayout="scroll">
              <ng-template pTemplate="header">
                <tr>
                  <th pSortableColumn="id" style="min-width: 4rem" i18n>
                    頁面代碼
                    <p-sortIcon field="id"></p-sortIcon>
                  </th>
                  <th pSortableColumn="title" style="min-width: 4rem" i18n>
                    頁面標題
                    <p-sortIcon field="title"></p-sortIcon>
                  </th>
                  <th pSortableColumn="path" style="min-width: 16rem" i18n>
                      頁面連結路徑
                      <p-sortIcon field="path"></p-sortIcon>
                  </th>
                  <th style="min-width: 12rem" i18n>
                      輸出模組名稱
                  </th>
                  <th style="min-width: 12rem" i18n>
                      版本
                  </th>
                  <th style="min-width: 4rem" i18n>
                      刪除
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-appPage let-index="rowIndex">
                <tr [pReorderableRow]="index">
                  <td>
                    {{ appPage._id }}
                  </td>
                  <td>
                    {{ appPage.pageTitle }}
                  </td>
                  <td>
                    {{ appPage.pageUrl }}
                  </td>
                  <td>
                    {{ appPage.moduleName }}
                  </td>
                  <td>
                    {{ appPage.versionNo }}
                  </td>
                  <td>
                    <button pButton icon="pi pi-trash" class="p-button-rounded p-button-outlined" (click)="onRemoveClick(appPage)"></button>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #createToolbar>
  <div class="flex align-items-center">
    <p-button i18n-label label="查詢" [routerLink]="['list']" routerLinkActive="router-link-active" ></p-button>
  </div>
  <div class="flex align-items-center">
    <p-button (click)="onClearClick()" i18n-label label="清除內容" styleClass="p-button-secondary"></p-button>
  </div>
  <div class="flex align-items-center">
    <p-button i18n-label label="完成" (onClick)="onCreateClick()"></p-button>
  </div>
</ng-template>

<ng-template #updateToolbar>
  <div class="flex align-items-center">
    <p-button i18n-label label="查詢" [routerLink]="['..']" routerLinkActive="router-link-active" ></p-button>
  </div>
  <div class="flex align-items-center">
    <p-dialog [style]="{width: '20vw'}" [(visible)]="isDeleteVisible" [closable]="false" [modal]="true">
      <ng-template pTemplate="header">
        <div class="flex flex-1 justify-content-between">
          <div>
            <span class="text-xl font-bold" i18n>刪除應用頁面</span>
          </div>
          <div>
            <p-button icon="pi pi-times" (click)="onCancelDelete()"></p-button>
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="body">
        <div class="flex flex-wrap align-items-center gap-2">
          <div>
            <i class="pi pi-question-circle font-bold notification-icon"></i>
          </div>
          <div>
            <span class="text-xl font-bold notification-text" i18n>您是否要刪除應用頁面</span>
          </div>
        </div>
        <p i18n>當應用頁面被永久刪除，便不能再復原，且資料庫所儲存的資料亦同步刪除。</p>
      </ng-template>
      <ng-template pTemplate="footer">
        <p-button icon="pi pi-times" (click)="onCancelDelete()" i18n-label label="取消" styleClass="p-button-secondary"></p-button>
        <p-button icon="pi pi-check" (click)="onConfirmDelete()" i18n-label label="確定"></p-button>
      </ng-template>
    </p-dialog>
    <p-button i18n-label label="刪除" styleClass="p-button-secondary" (onClick)="onDeleteClick()"></p-button>
  </div>
  <div class="flex align-items-center">
    <p-button (click)="onClearClick()" i18n-label label="復原" styleClass="p-button-secondary"></p-button>
  </div>
  <div class="flex align-items-center">
    <p-button i18n-label label="完成" (onClick)="onSaveClick()"></p-button>
  </div>
</ng-template>
